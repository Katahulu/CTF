<script>
    // Authentication and UI Logic
    const loginBtn = document.getElementById("login-btn");
    const logoutBtn = document.getElementById("logout-btn");
    const userInfo = document.getElementById("user-info");
    const userEmail = document.getElementById("user-email");

    loginBtn.addEventListener("click", async () => {
        const provider = new firebase.auth.GoogleAuthProvider();
        try {
            const result = await auth.signInWithPopup(provider);
            const user = result.user;
            userEmail.textContent = user.email;
            loginBtn.style.display = "none";
            logoutBtn.style.display = "block";
            userInfo.style.display = "block";
        } catch (error) {
            console.error("Login failed:", error.message);
        }
    });

    logoutBtn.addEventListener("click", () => {
        auth.signOut().then(() => {
            loginBtn.style.display = "block";
            logoutBtn.style.display = "none";
            userInfo.style.display = "none";
        });
    });

    // Registry Functionality
    async function registerPerson() {
        const name = document.getElementById("name").value.trim();
        const email = userEmail.textContent;

        if (!name || !email) {
            alert("Please provide your name.");
            return;
        }

        try {
            await db.collection("people").add({ name, email });
            alert("Person registered successfully!");
            fetchRegistry(); // Refresh the registry list
        } catch (error) {
            console.error("Error registering person:", error.message);
        }
    }

    async function fetchRegistry() {
        const resultsDiv = document.getElementById("registry-results");
        resultsDiv.innerHTML = "<h2>Registry:</h2>";
        try {
            const snapshot = await db.collection("people").get();
            snapshot.forEach(doc => {
                const person = doc.data();
                resultsDiv.innerHTML += `<p>${person.name} - ${person.email}</p>`;
            });
        } catch (error) {
            console.error("Error fetching registry:", error.message);
        }
    }

    // Fetch registry automatically when authenticated
    auth.onAuthStateChanged(user => {
        if (user) {
            fetchRegistry();
        }
    });
</script>
