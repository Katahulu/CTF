<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CTF Challenge</title>
    <style>
        /* Your existing styles remain unchanged */
    </style>
</head>
<body>
    <h1>Welcome to the MR CTF</h1>
    <div id="auth-section">
        <button id="sign-in-btn">Sign In with Gmail</button>
        <button id="sign-out-btn" style="display: none;">Sign Out</button>
        <p id="user-info" style="display: none;">Logged in as: <span id="user-email"></span></p>
    </div>
    <div id="questions" style="display: none;">
        <!-- Your existing questions go here -->
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-firestore.js"></script>
    <script>
        // Your Firebase config object
        const firebaseConfig = {
            apiKey: "AIzaSyBPs8XJx3bWlLAaprFyni_eptXCei3D0Z8",
            authDomain: "knfctf.firebaseapp.com",
            projectId: "knfctf",
            storageBucket: "knfctf.firebasestorage.app",
            messagingSenderId: "867816662069",
            appId: "1:867816662069:web:b52d6fd936aa7159f57d7c",
            measurementId: "G-01ZH8EDKBD"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // DOM elements
        const signInBtn = document.getElementById("sign-in-btn");
        const signOutBtn = document.getElementById("sign-out-btn");
        const userInfo = document.getElementById("user-info");
        const userEmail = document.getElementById("user-email");
        const questionsSection = document.getElementById("questions");

        // Sign in with Gmail
        signInBtn.addEventListener("click", async () => {
            const provider = new firebase.auth.GoogleAuthProvider();
            try {
                const result = await auth.signInWithPopup(provider);
                const user = result.user;

                // Display user info
                userEmail.textContent = user.email;
                userInfo.style.display = "block";
                signInBtn.style.display = "none";
                signOutBtn.style.display = "inline-block";
                questionsSection.style.display = "block";

                // Save user to Firestore if new
                const userRef = db.collection("users").doc(user.uid);
                const doc = await userRef.get();
                if (!doc.exists) {
                    await userRef.set({
                        email: user.email,
                        name: user.displayName,
                        registeredAt: new Date()
                    });
                }
            } catch (error) {
                console.error("Sign-in error:", error);
            }
        });

        // Sign out
        signOutBtn.addEventListener("click", () => {
            auth.signOut().then(() => {
                userInfo.style.display = "none";
                signInBtn.style.display = "inline-block";
                signOutBtn.style.display = "none";
                questionsSection.style.display = "none";
            });
        });
    </script>
</body>
</html>
